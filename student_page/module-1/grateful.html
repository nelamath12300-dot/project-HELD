<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Grateful Moments — Draw</title>

<style>
  :root{
    --bg:#FDF9F6; /* Soft cream background */
    --white:#416285; /* Deep blue-gray text */
    --saved-bg:#DBB8AA; /* Soft peach */
    --saved-text:#FDF9F6; /* Soft cream text */
  }

  html,body{
    height:100%;
    margin:0;
    font-family:Inter, system-ui, sans-serif;
    background:linear-gradient(180deg,#d49e74,#d19f82); /* Cream to light warm gray gradient */
    color:var(--white);
  }
  .back-btn{
  position:absolute;
  top:30px;
  left:30px;
  padding:8px 16px;
  border-radius:999px;
  background:#DBB8AA; /* Soft peach */
  color:#416285;
  font-size:26px;
  cursor:pointer;
  border:1px solid #8BC6CA;
}
  /* LEFT-SIDE BACK BUTTON */
  .back-btn{
    position:fixed;
    top:16px;
    left:16px;
    padding:10px 16px;
    border-radius:999px;
    background:#DBB8AA; /* Soft peach */
    color:#416285;
    font-weight:700;
    cursor:pointer;
    z-index:10;
    border:1px solid #8BC6CA;
  }

  .back-btn:hover{
    background:#c9a69a;
  }

  .wrap{
    padding:24px;
    max-width:900px;
    margin:0 auto;
  }

  /* ⬆️ FONT SIZE for grateful moment */
  h1{
    font-family:"Playfair Display",serif;
    font-size:42px;
    margin:6px 0;
    color:#416285; /* Deep blue-gray */
  }

  /* ⬆️ FONT SIZE for bS */
  p.lead{
    color:#5A7A9C; /* Medium blue-gray */
    margin-bottom:16px;
    font-size:22px;
  }

  .canvas-area{
    margin-top:18px;
    border-radius:18px;
    background:#be785d; /* White */
    padding:14px;
    display:flex;
    flex-direction:column;
    align-items:center;
    border:1px solid #DBB8AA;
    box-shadow:0 8px 32px rgba(65, 98, 133, 0.1);
  }

  canvas{
    background:#FDF9F6; /* Soft cream canvas background */
    width:100%;
    max-width:720px;
    height:480px;
    border-radius:12px;
    touch-action:none;
    border:2px solid #8BC6CA; /* Soft teal border */
  }

  .controls{
    display:flex;
    gap:10px;
    margin-top:14px;
    flex-wrap:wrap;
    align-items:center;
    justify-content:center;
  }

  .btn{
    padding:10px 16px;
    border-radius:12px;
    border:none;
    background:#416285; /* Deep blue-gray */
    color:#FDF9F6;
    font-weight:700;
    cursor:pointer;
    transition:all 0.2s ease;
  }

  .btn:hover{
    background:#355074; /* Darker blue-gray */
    transform:translateY(-2px);
    box-shadow:0 4px 12px rgba(65, 98, 133, 0.2);
  }

  .color{
    width:34px;
    height:34px;
    border-radius:50%;
    border:2px solid #8BC6CA;
    cursor:pointer;
    transition:transform 0.2s ease, border-color 0.2s ease;
  }

  .color:hover{
    transform:scale(1.1);
    border-color:#EFCD52;
  }

  .saved-msg{
    display:none;
    margin-top:16px;
    padding:10px 14px;
    background:#DBB8AA; /* Soft peach */
    color:#416285;
    border-radius:10px;
    font-weight:600;
    border:1px solid #8BC6CA;
    box-shadow:0 4px 12px rgba(65, 98, 133, 0.1);
  }
</style>
</head>

<body>

<div class="back-btn" onclick="location.href='best-self.html'"> ← Back</div>

<div class="wrap">
  <h1>Grateful Moments — Draw</h1>

  <p class="lead">
    Draw or sketch something that brought you joy today.
  </p>

  <div class="canvas-area">
    <canvas id="sketch" width="800" height="600"></canvas>

    <div class="controls">
      <button class="btn" id="clearBtn">Clear</button>
      <button class="btn" id="undoBtn">Undo</button>

      <div class="color" style="background:#416285" data-color="#416285"></div>
      <div class="color" style="background:#EFCD52" data-color="#EFCD52"></div>
      <div class="color" style="background:#8BC6CA" data-color="#8BC6CA"></div>
      <div class="color" style="background:#DBB8AA" data-color="#DBB8AA"></div>
      <div class="color" style="background:#5A7A9C" data-color="#5A7A9C"></div>

      <button class="btn" id="saveBtn">Save</button>
    </div>

    <div id="saveMsg" class="saved-msg">
      Saved — your Grateful Moment is stored.
    </div>
  </div>
</div>

<script>
const canvas = document.getElementById('sketch');
const ctx = canvas.getContext('2d');

let drawing = false;
let strokeColor = '#416285';
let lineWidth = 6;

/* --------- STROKE HISTORY (UNDO FIXED) ---------- */
const history = [];

/* Save canvas snapshot */
function saveHistory(){
  history.push(canvas.toDataURL());

  // limit memory use
  if(history.length > 40)
    history.shift();
}

/* Save initial blank canvas state */
saveHistory();

/* Proper UNDO — remove last stroke only */
function undo(){
  // remove latest snapshot
  history.pop();

  // if nothing left → clear canvas
  if(history.length === 0){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    return;
  }

  // load previous snapshot
  const img = new Image();
  img.onload = () => {
    ctx.clearRect(0,0,canvas.width,canvas.height);
    ctx.drawImage(img,0,0);
  };
  img.src = history[history.length - 1];
}

/* ---------- POSITION FIX ---------- */
function getPos(e){
  const r = canvas.getBoundingClientRect();
  const scaleX = canvas.width / r.width;
  const scaleY = canvas.height / r.height;
  return {
    x: (e.clientX - r.left) * scaleX,
    y: (e.clientY - r.top) * scaleY
  };
}

/* ---------- DRAWING ---------- */
canvas.addEventListener('pointerdown', e=>{
  drawing = true;
  const pos = getPos(e);

  ctx.strokeStyle = strokeColor;
  ctx.lineWidth = lineWidth;
  ctx.lineCap = 'round';

  ctx.beginPath();
  ctx.moveTo(pos.x,pos.y);
});

canvas.addEventListener('pointermove', e=>{
  if(!drawing) return;
  const pos = getPos(e);
  ctx.lineTo(pos.x,pos.y);
  ctx.stroke();
});

function endStroke(){
  if(!drawing) return;
  drawing = false;
  saveHistory();
}

canvas.addEventListener('pointerup', endStroke);
canvas.addEventListener('pointercancel', endStroke);

/* ---------- BUTTONS ---------- */
document.getElementById('clearBtn').onclick = ()=>{
  saveHistory();
  ctx.clearRect(0,0,canvas.width,canvas.height);
};

document.getElementById('undoBtn').onclick = undo;

document.querySelectorAll('.color').forEach(c=>{
  c.onclick = ()=> strokeColor = c.dataset.color;
});

document.getElementById('saveBtn').onclick = ()=>{
  const data = canvas.toDataURL('image/png');
  localStorage.setItem('gratefulMomentDrawing', data);

  const msg = document.getElementById('saveMsg');
  msg.style.display = 'block';
  setTimeout(()=> msg.style.display='none', 3000);
};
</script>
</body>
</html>
